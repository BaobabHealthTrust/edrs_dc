<script type="text/javascript">
	function removeDollar(){
			var input_element = __$('touchscreenInput' + tstCurrentPage);
			console.log(input_element);
			if (input_element && input_element.value.match(/.+\$$/i) != null){
				 setTimeout(function(){
						barcode_element.value = input_element.value.substring(0,input_element.value.length-1);
				},1000);		
			}
			else{
				console.log("No dollar");
			}
	}

	var patnum = ""
	var setFocusTimeout = 5000;
	var checkForBarcodeTimeout = 1500;
	var barcodeFocusTimeoutId = null;
	var barcodeFocusOnce = false;
	var barcodeId = '';
	var focusOnce = false;
	var barcode_element;

	function loadBarcodePage() {

		  focusForBarcodeInput()

		  checkForBarcode()

	}

	function focusForBarcodeInput(){

			if (!barcodeId) {
				barcodeId = "person_barcode";
			}

		  	barcode_element = document.getElementById(barcodeId);

			if (barcode_element) {
				barcode_element.focus();
				if (!focusOnce) barcodeFocusTimeoutId = window.setTimeout("focusForBarcodeInput()", setFocusTimeout);
			}
	}

	function checkForBarcode(validAction){

			if (__$("person_barcode")){

				var input_element = __$('touchscreenInput' + tstCurrentPage);

				if (input_element && input_element.value.match(/.+\$$/i) != null){

					 barcode_element.value = input_element.value.substring(0,input_element.value.length-1);

					 setTimeout(function(){

					 		 gotoNextPage();
					 },500);

					
						
				}else{
					window.setTimeout("checkForBarcode()", checkForBarcodeTimeout)
				}
			}
	}

	window.addEventListener("load", loadBarcodePage, false);
</script>
<% if params[:search_criteria].present? %>

	<%= render :partial => "people_view" %>

<%else%>

	<%= form_tag("/people/search",:method=>:get) do %>

		<%= select_tag "search_criteria", options_for_select(["By Barcode","By Death Entry Number","By Death Registration Number","By Personal Details of the deceased","By Home Address","By Mother details","By Father details","By Informant details"], " "), {:helpText => 'Select search criteria',:tt_requireNextClick => false,:tt_pageStyleClass =>"NoKeyboard" }%>

		<%= text_field_tag "person[barcode]",nil , {:name => "barcode",:helpText=> "Scan Barcode",:tt_pageStyleClass =>"NoKeyboard",:tt_onUnLoad=>"removeDollar()",:condition => "__$('search_criteria').value =='By Barcode'"} %>

		<%= text_field_tag "death_entry_number", nil, {:helpText => 'Enter Death Entry Number',:condition => "__$('search_criteria').value =='By Death Entry Number'"}  %>

		<%= text_field_tag "death_registration_number", nil, {:helpText => 'Enter Death Registration Number',:condition => "__$('search_criteria').value =='By Death Registration Number'"}  %>

		<%= text_field_tag "last_name", nil, {:helpText => 'Enter last name',:condition => "__$('search_criteria').value =='By Personal Details of the deceased'"}  %>
		<%= text_field_tag "first_name", nil, {:helpText => 'Enter First name',:condition => "__$('search_criteria').value =='By Personal Details of the deceased'"}  %>
		<%= select_tag "search_criteria", options_for_select(["Female","Male"], " "), {:helpText => 'Sex / Gender',:tt_requireNextClick => false,:tt_pageStyleClass =>"NoKeyboard",:condition => "__$('search_criteria').value =='By Personal Details of the deceased'" }%>

		<%= text_field_tag "home_country", nil, {:helpText => 'Home Country',:condition => "__$('search_criteria').value =='By Home Address'"}  %>
		<%= text_field_tag "home_district", nil, {:helpText => 'Home district',:condition => "__$('search_criteria').value =='By Home Address'"}  %>
		<%= text_field_tag "home_ta", nil, {:helpText => 'Home TA',:condition => "__$('search_criteria').value =='By Home Address'"}  %>
		<%= text_field_tag "home_village", nil, {:helpText => 'Home Village',:condition => "__$('search_criteria').value =='By Home Address'"}  %>

		<%= text_field_tag "mother_last_name", nil, {:helpText => 'Mother Last Name',:condition => "__$('search_criteria').value =='By Mother details'"}  %>
		<%= text_field_tag "mother_first_name", nil, {:helpText => 'Mother First Name',:condition => "__$('search_criteria').value =='By Mother details'"}  %>

		<%= text_field_tag "father_last_name", nil, {:helpText => 'Father Last Name',:condition => "__$('search_criteria').value =='By Father details'"}  %>
		<%= text_field_tag "father_first_name", nil, {:helpText => 'Father First Name',:condition => "__$('search_criteria').value =='By Father details'"}  %>

		<%= text_field_tag "informant_last_name", nil, {:helpText => 'Informant Last Name',:condition => "__$('search_criteria').value =='By Informant details'"}  %>
		<%= text_field_tag "informant_first_name", nil, {:helpText => 'Informant First Name',:condition => "__$('search_criteria').value =='By informant details'"}  %>
	<%end%>
<%end%>