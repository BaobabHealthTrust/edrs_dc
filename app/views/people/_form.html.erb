<script type="text/javascript">
	var site_type = "<%= site_type %>";
</script>
<script src="/assets/edrs.js"></script>
<script src="/assets/form.js"></script>

<%= form_for @person, :url => '/people/create', :method => :post do |f| %>
	<input type="hidden" name="person[relationship]" id="person_relationship"> value="<%params[:relationship]%>">
	<input type="hidden" name="person[delayed_registration]" id="person_delayed_registration"value="No">
	<% if params[:relationship].include? "Missing"%>
		<section name="Court Order">
			<sub id="person_court_order_section" name="Court order attached">
				<%= select_tag("person[court_order]",options_for_select([" ", "Yes", "No"], nil),:helpText =>"Court order attached?",:tt_requireNextClick => false, :tt_onUnLoad=>"courtOrder()") %>
			</sub>
		</section>
	<%end%>
	<% if params[:relationship].include? "Unnatural Deaths"%>
		<section name="Police report">
			<sub id="person_police_report_section" name="Police report attached">
				<%= select_tag("person[police_report]",options_for_select([" ", "Yes", "No"], nil),:helpText =>"Police report attached?",:tt_requireNextClick => false, :tt_onUnLoad=>"policeReport()") %>
			</sub>
		</section>
	<%end%>
	<% if true %>
		<section name="Barcode">
			<sub id="person_barcode_section" name="Barcode">
				<%= text_field_tag "person[barcode]",nil , {:helpText=> "Scan Form Barcode <i style='color: red'>*</i>",:tt_pageStyleClass =>"NoKeyboard",:tt_onUnLoad=>"removeDollar();checkBarcode()"} %>
			</sub>
		</section>
	<%end%>
    <section name="Personal details of deceased">
            <sub id="person_details" name="Details of deceased">

                <%= (f.text_field :last_name, 
                				 :helpText => "Surname <i style='color: red'>*</i>",
                                 :allowFreeText =>true, 
                                 :ajaxURL => "/get_last_names?search=",
                                 :tt_onUnLoad=>"validateName('person',1)",
                                 :tt_onLoad=> "removeUnknown()") rescue "" %>

                <%= (f.text_field :first_name,
                				  :helpText => "First name <i style='color: red'>*</i>",
                				  :allowFreeText =>true,  
                				  :ajaxURL => "/get_first_names?search=",
                				  :tt_onUnLoad=>"validateName('person',2)",
                				  :tt_onLoad=> "removeUnknown()") rescue "" %>

                <%= (f.text_field :middle_name, 
                				  :helpText => "Other names",
                				  :allowFreeText =>true, 
                				  :optional => :true, 
                				  :ajaxURL => "/get_first_names?search=",
                				  :tt_onUnLoad=>"validateOtherName('person',3)",
                				  :tt_onLoad=> "removeUnknown()") rescue "" %>

                <%= text_field_tag "person[id_number]",nil , {
                				  :helpText => "ID No", 
                				  :optional => true, 
                				  :validationRule=>"^[a-zA-Z0-9]{8}$",
                				  :validationMessage=> "Nation ID No. is alpha numeric with exaclty 8 characters"} %>

                <%= text_field_tag "person[nationality]",nil , {
                				  :helpText => "Nationality <i style='color: red'>*</i>",
                				  :ajaxURL => "/nationalities?search_string="} %>

                 <%= select_tag("person[gender]",options_for_select([" ", "Female", "Male"], @person[:gender]),
                 				  :helpText =>"Sex <i style='color: red'>*</i>",
                 				  :tt_requireNextClick => false) %>

                <%= text_field_tag "person[birth_year]", nil, {
                					:helpText => "Year of Birth <i style='color: red'>*</i>", 
                					:field_type => 'number', 
                					:absoluteMin => "1890", 
                					:min => "1940", 
                					:absoluteMax => Date.today.year, 
                					:tt_pageStyleClass => "Numeric NumbersWithUnknown"}  %>

                <%= select_tag "person[birth_month]", options_for_select(["January","February","March","April","May","June","July","August","September","October","November","December"], " "), {
                				   :helpText => "Month of Birth <i style='color: red'>*</i>", 
                				   :condition => '$("person_birth_year").value.toLowerCase() != "unknown"',
                				   :validationJS => "validateDOB();",
                				   :validationMessage => 'Please enter a valid date', 
                				   :tt_onLoad =>"__$('keyboard').style.display = 'none'",
                				   :tt_requireNextClick => false,
                				   :tt_pageStyleClass =>"NoKeyboard longSelectList",
                				   :tt_onUnLoad=>"validateAndProcessMonth()" }%>

                <%= text_field_tag "person[age_estimate]", nil, {
                				  :helpText => "Age Estimate <i style='color: red'>*</i>",
                				   :absoluteMin => 1, 
                				   :absoluteMax => 120, 
                				   :field_type => 'number', 
                				   :condition => '$("person_birth_year").value == "Unknown"', 
                				   :tt_onLoad => "$('nextButton').style.display = 'block';", 
                				   :tt_pageStyleClass => "Numeric NumbersOnly",
                				   :tt_onUnLoad => "setEstimatedAgeValue()"} %>

                <%= text_field_tag "person[birth_day]",  nil, 
                				  :field_type => 'number', 
                				  :helpText => "Birth Day <i style='color: red'>*</i>", 
                				  :condition => '($("person_birth_year").value != "Unknown") && ($("person_birth_month").value != "Unknown")', 
                				  :tt_onLoad =>  "monthDaysKeyPad();$('nextButton').style.display = 'block'" ,
                				  :tt_onUnLoad => "setAgeValues()"%>

                <%= (f.hidden_field :birthdate) rescue "" %>

                <%= f.hidden_field :birthdate_estimated rescue "" %>

                <%= text_field_tag "person[birth_certificate_number]",nil , {
                		:helpText => "Birth Certificate No.", 
                		:optional => true} %>
            </sub>

            <sub id="death_details" name="Details of death">
                <%= (f.text_field :date_of_death,
                				  :helpText => "Date of Death <i style='color: red'>*</i>",
                				  :field_type => "date" ,
                				  :tt_onLoad =>"removeUnknown()",
                				  :tt_onUnLoad => "validateDeathDate()") rescue "" %>
                <input type="hidden" id="person_place_of_death_country" name="person[place_of_death_country]" value="Malawi">
                <% if site_type == "facility" %>
                    <%= (f.hidden_field :place_of_death, :value => "Health Facility")  %>
                    <%= (f.hidden_field :place_of_death_district, :value => @district.name) %>
                    <%= (f.hidden_field :hospital_of_death, :value => @facility.name) %>
                <% elsif site_type =="dc" %>
                    <%= select_tag("person[place_of_death]", options_for_select(["","Health Facility", "Home","Other"], @person[:place_of_death]),
                    					:id=> "person_place_of_death",
                    					:helpText =>"Place of Death <i style='color: red'>*</i>", 
                    					:tt_onUnLoad =>"setAjaxUrl(-1)",
                    					:tt_requireNextClick => false,
                    					:tt_pageStyleClass =>"NoKeyboard") %>

                    <%= text_field_tag "person[place_of_death_district]", nil, {
                    					:helpText => "Place of Death District <i style='color: red'>*</i>" , 
                    					:tt_onUnLoad => "setAjaxUrl(0)"} %>

                    <%= text_field_tag "person[hospital_of_death]", nil, {
                    					:helpText => "Health Facility (<i>Place of death</i>) <i style='color: red'>*</i>",
                    					:condition => "__$('person_place_of_death').value.trim()=='Health Facility'"} %>

                    <%= text_field_tag "person[place_of_death_ta]", nil, {
                    					:helpText => "Traditional authority (<i>Place of death</i>) <i style='color: red'>*</i>",
                    					:condition => "__$('person_place_of_death').value.match('Home')", 
                    					:tt_onUnLoad => "setAjaxUrl(1)"} %>

                     <%= text_field_tag "person[other_place_of_death_ta]", nil, {
                     					:helpText => "Other Traditional Authority specify (<i>Place of death</i>) <i style='color: red'>*</i>",
                     					:condition => "__$('person_place_of_death_ta').value =='Other'"} %>

               		<%= text_field_tag "person[place_of_death_village]", nil, {
               							:helpText => "Village (<i>Place of death</i>) <i style='color: red'>*</i>",
               							:condition => "__$('person_place_of_death_ta').value.length > 0 && __$('person_place_of_death_ta').value != 'Other'"} %>

               		<%= text_field_tag "person[other_place_of_death_village]", nil, {
               							:helpText => "Other Village specify (<i>Place of death</i>) <i style='color: red'>*</i>",
               							:condition => "__$('person_place_of_death_ta').value =='Other' || __$('person_place_of_death_village').value =='Other'"} %>

                	<%= (f.text_field :other_place_of_death,
                						:helpText => "Other specify (<i>Place of death</i>) <i style='color: red'>*</i>",
                						:condition => "__$('person_place_of_death').value.match('Other')") rescue "" %>
                <% end %>


             
            </sub>

            <% render :partial => "physical_address" %>

            <%= render :partial => "home_address" %>

            <sub id='pregnancy_status' name="Pregnancy status">
               <%= select_tag("person[died_while_pregnant]", options_for_select(['No', 'Yes'], @person[:died_while_pregnant]),
                        :helpText =>"Did the death occur while pregnant?(<i style='font-size: 18px'> at the time of delivery or within 6 weeks after the end of pregnancy</i>)", 
                        :condition =>"validatePregnancy()",
                        :tt_requireNextClick => false,
                        :tt_onUnLoad=>"flagIfOut()") %>
            </sub>
  	</section>

    <%= render :partial => "parents_details" %>

    <%= render :partial => "informant_details" %>

  	<%= render :partial => "verification" %>

<% end %>